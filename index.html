<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Followw - The Flow Operating System</title>
    <meta name="description" content="Work that moves with you. A complete Flow Operating System for modern professionals.">
    <!-- Confetti library for celebrations -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* ===== FOLLOWW COMPLETE DESIGN SYSTEM ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-bg: #000000;
            --color-card: #0A0A0A;
            --color-text: #FFFFFF;
            --color-text-secondary: #888888;
            --color-accent: #FFFFFF;
            --color-success: #FFFFFF;
            --color-warning: #CCCCCC;
            --color-error: #FFFFFF;

            --gray-50: #0A0A0A;
            --gray-100: #1A1A1A;
            --gray-200: #2A2A2A;
            --gray-300: #3A3A3A;
            --gray-400: #666666;
            --gray-500: #888888;

            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;

            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;

            --transition-fast: 180ms cubic-bezier(0.32, 0.08, 0.24, 1.0);
            --transition-normal: 220ms cubic-bezier(0.32, 0.08, 0.24, 1.0);
            --transition-slow: 400ms cubic-bezier(0.32, 0.08, 0.24, 1.0);

            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.12);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-bg: #000000;
                --color-card: #0A0A0A;
                --color-text: #FFFFFF;
                --color-text-secondary: #888888;
                --gray-100: #1A1A1A;
                --gray-200: #2A2A2A;
                --gray-300: #3A3A3A;
                --gray-400: #666666;
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'SF Pro Text', sans-serif;
            background: #000000;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: var(--color-text);
            overflow: hidden;
        }

        /* Welcome Screen */
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: welcomeFade 0.6s ease;
        }

        .welcome-screen.hidden {
            animation: welcomeFadeOut 0.6s ease forwards;
            pointer-events: none;
        }

        @keyframes welcomeFade {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes welcomeFadeOut {
            to { opacity: 0; }
        }

        .welcome-logo {
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            margin-bottom: var(--space-xl);
            animation: logoFloat 3s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .welcome-title {
            font-size: 48px;
            font-weight: 700;
            color: white;
            margin-bottom: var(--space-sm);
            text-align: center;
            letter-spacing: -0.02em;
        }

        .welcome-tagline {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: var(--space-2xl);
            text-align: center;
        }

        .welcome-button {
            padding: 16px 48px;
            border: 2px solid white;
            background: transparent;
            color: white;
            font-size: 18px;
            font-weight: 600;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            box-shadow: 0 10px 30px rgba(255, 255, 255, 0.1);
        }

        .welcome-button:hover {
            background: white;
            color: black;
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(255, 255, 255, 0.2);
        }

        /* Main App */
        .app-container {
            width: 100%;
            max-width: 1200px;
            height: 90vh;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-xl);
            box-shadow: 0 20px 40px rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            animation: appSlideIn 0.5s cubic-bezier(0.32, 0.08, 0.24, 1.0);
            opacity: 0;
        }

        .app-container.visible {
            opacity: 1;
        }

        @media (prefers-color-scheme: dark) {
            .app-container {
                background: rgba(10, 10, 10, 0.95);
            }
        }

        @keyframes appSlideIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(30px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-lg);
            border-bottom: 1px solid var(--gray-200);
            flex-shrink: 0;
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .greeting {
            flex: 1;
            min-width: 200px;
        }

        .greeting h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 4px;
            letter-spacing: -0.02em;
        }

        .greeting p {
            font-size: 14px;
            color: var(--color-text-secondary);
        }

        .view-tabs {
            display: flex;
            gap: var(--space-sm);
            flex: 0 0 auto;
        }

        .tab {
            padding: 8px 20px;
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            font-size: 14px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tab:hover {
            background: var(--gray-200);
        }

        .tab.active {
            background: white;
            color: black;
        }

        .header-actions {
            display: flex;
            gap: var(--space-sm);
            align-items: center;
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            font-size: 18px;
        }

        .icon-btn:hover {
            background: var(--gray-200);
            color: var(--color-text);
        }

        .shortcut-hint {
            font-size: 11px;
            color: var(--color-text-secondary);
            padding: 4px 12px;
            background: var(--gray-200);
            border-radius: 12px;
            font-family: monospace;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-lg);
        }

        .main-content::-webkit-scrollbar {
            width: 8px;
        }

        .main-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .main-content::-webkit-scrollbar-thumb {
            background: var(--gray-300);
            border-radius: 4px;
        }

        /* Views */
        .view {
            display: none;
            animation: viewFadeIn var(--transition-normal);
        }

        .view.active {
            display: block;
        }

        @keyframes viewFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Card */
        .card {
            background: var(--color-card);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .stat-card {
            padding: var(--space-lg);
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .stat-content h3 {
            font-size: 32px;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 4px;
        }

        .stat-content p {
            font-size: 13px;
            color: var(--color-text-secondary);
            text-transform: lowercase;
        }

        .stat-trend {
            font-size: 12px;
            color: var(--color-success);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Quick Add */
        .quick-add {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .quick-add-icon {
            width: 24px;
            height: 24px;
            color: var(--color-accent);
            font-size: 20px;
        }

        .quick-add input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 17px;
            outline: none;
            color: var(--color-text);
            font-family: inherit;
        }

        .quick-add input::placeholder {
            color: var(--color-text-secondary);
        }

        /* Sections */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .section-title {
            font-size: 13px;
            color: var(--color-text-secondary);
            text-transform: lowercase;
            font-weight: 500;
        }

        .section-count {
            font-size: 12px;
            color: var(--color-text-secondary);
            background: var(--gray-200);
            padding: 2px 8px;
            border-radius: 10px;
        }

        .tasks-section {
            margin-bottom: var(--space-xl);
        }

        /* Task */
        .task {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            margin-bottom: var(--space-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
        }

        .task:hover {
            transform: translateX(4px);
        }

        .task.completed .task-title {
            text-decoration: line-through;
            opacity: 0.5;
        }

        .task.focus {
            border-left: 3px solid var(--color-accent);
            padding-left: calc(var(--space-md) - 3px);
        }

        .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--gray-400);
            border-radius: 50%;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .checkbox:hover {
            border-color: var(--color-accent);
            transform: scale(1.1);
        }

        .task.completed .checkbox {
            background: var(--color-success);
            border-color: var(--color-success);
            animation: checkPop 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes checkPop {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .task.completed .checkbox::after {
            content: '✓';
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .task-content {
            flex: 1;
            min-width: 0;
        }

        .task-title {
            font-size: 16px;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .task-meta {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 12px;
            color: var(--color-text-secondary);
            flex-wrap: wrap;
        }

        .task-tag {
            padding: 2px 8px;
            background: var(--gray-200);
            border-radius: 10px;
            font-size: 11px;
        }

        .task-client {
            color: var(--color-accent);
            font-weight: 500;
        }

        .task-actions {
            display: flex;
            gap: var(--space-xs);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .task:hover .task-actions {
            opacity: 1;
        }

        .task-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            font-size: 16px;
            color: var(--color-text-secondary);
        }

        .task-btn:hover {
            background: var(--gray-200);
            color: var(--color-text);
        }

        .task-btn.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Floating Timer */
        .floating-timer {
            display: none;
            flex-direction: row;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            margin-top: var(--space-lg);
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .floating-timer.active {
            display: flex;
            animation: timerSlide 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes timerSlide {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .timer-pulse {
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            position: relative;
            animation: pulse 1.5s ease-in-out infinite;
            flex-shrink: 0;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);
            }
            50% {
                box-shadow: 0 0 0 20px rgba(255, 255, 255, 0);
            }
        }

        .timer-info {
            flex: 1;
            min-width: 0;
        }

        .timer-task {
            font-weight: 600;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .timer-label {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .timer-display {
            font-size: 28px;
            font-weight: 700;
            color: white;
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.02em;
        }

        .timer-stop {
            width: 40px;
            height: 40px;
            border: none;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            color: var(--color-error);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .timer-stop:hover {
            background: rgba(239, 71, 111, 0.1);
            transform: scale(1.1);
        }

        /* Command Palette */
        .command-palette {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            z-index: 9000;
            align-items: flex-start;
            justify-content: center;
            padding-top: 15vh;
            animation: modalFade 0.2s ease;
        }

        .command-palette.active {
            display: flex;
        }

        @keyframes modalFade {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .command-content {
            width: 600px;
            max-width: 90%;
            background: var(--color-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            animation: commandSlide 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes commandSlide {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .command-input-wrapper {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md);
            border-bottom: 1px solid var(--gray-200);
        }

        .command-input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 18px;
            outline: none;
            color: var(--color-text);
            font-family: inherit;
        }

        .command-results {
            max-height: 400px;
            overflow-y: auto;
        }

        .command-item {
            padding: var(--space-md);
            cursor: pointer;
            transition: background var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .command-item:hover,
        .command-item.selected {
            background: var(--gray-100);
        }

        .command-icon {
            width: 36px;
            height: 36px;
            background: var(--gray-200);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .command-item-content h4 {
            font-size: 15px;
            margin-bottom: 2px;
        }

        .command-item-content p {
            font-size: 13px;
            color: var(--color-text-secondary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--space-2xl);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: var(--space-md);
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: var(--space-sm);
            font-weight: 600;
        }

        .empty-state p {
            color: var(--color-text-secondary);
            font-size: 15px;
            line-height: 1.6;
        }

        /* Reflection Overlay */
        .reflection {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .reflection.active {
            display: flex;
            animation: reflectionFade 0.8s ease;
        }

        @keyframes reflectionFade {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .reflection-content {
            text-align: center;
            color: white;
            padding: var(--space-2xl);
            max-width: 700px;
        }

        .reflection-wave {
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, transparent, white, transparent);
            margin-bottom: var(--space-2xl);
            border-radius: 2px;
            animation: wave 4s ease-in-out;
        }

        @keyframes wave {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }

        .reflection h2 {
            font-size: 40px;
            margin-bottom: var(--space-xl);
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        .reflection-stats {
            display: flex;
            gap: var(--space-2xl);
            justify-content: center;
            margin-bottom: var(--space-xl);
            flex-wrap: wrap;
        }

        .reflection-stat h3 {
            font-size: 36px;
            color: white;
            margin-bottom: var(--space-sm);
            font-weight: 700;
        }

        .reflection-stat p {
            font-size: 14px;
            opacity: 0.8;
            text-transform: lowercase;
        }

        .reflection-insight {
            font-size: 20px;
            opacity: 0.9;
            line-height: 1.6;
            margin-bottom: var(--space-xl);
        }

        .reflection-close {
            padding: 12px 32px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: transparent;
            color: white;
            font-size: 16px;
            font-weight: 500;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .reflection-close:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* Analytics */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .analytics-card {
            padding: var(--space-lg);
        }

        .analytics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .analytics-title {
            font-size: 14px;
            color: var(--color-text-secondary);
            text-transform: lowercase;
            font-weight: 500;
        }

        .chart-bar {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-sm);
        }

        .chart-label {
            font-size: 13px;
            width: 70px;
            color: var(--color-text-secondary);
        }

        .chart-track {
            flex: 1;
            height: 28px;
            background: var(--gray-200);
            border-radius: 14px;
            overflow: hidden;
            position: relative;
        }

        .chart-fill {
            height: 100%;
            background: white;
            border-radius: 14px;
            transition: width 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            color: black;
            font-size: 12px;
            font-weight: 600;
        }

        .chart-value {
            font-size: 14px;
            font-weight: 600;
            width: 50px;
            text-align: right;
        }

        .insight-item {
            padding: var(--space-md);
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-sm);
            display: flex;
            align-items: flex-start;
            gap: var(--space-sm);
        }

        .insight-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .insight-text {
            font-size: 14px;
            line-height: 1.6;
            color: var(--color-text-secondary);
        }

        /* Clients View */
        .clients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--space-md);
        }

        .client-card {
            padding: var(--space-lg);
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .client-card:hover {
            transform: translateY(-4px);
        }

        .client-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .client-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
            color: white;
        }

        .client-info h3 {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .client-info p {
            font-size: 13px;
            color: var(--color-text-secondary);
        }

        .client-stats {
            display: flex;
            gap: var(--space-lg);
            padding-top: var(--space-md);
            border-top: 1px solid var(--gray-200);
        }

        .client-stat {
            text-align: center;
        }

        .client-stat-value {
            font-size: 20px;
            font-weight: 700;
            color: white;
        }

        .client-stat-label {
            font-size: 11px;
            color: var(--color-text-secondary);
            text-transform: lowercase;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-family: inherit;
        }

        .btn-primary {
            background: white;
            color: black;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.3);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        /* Focus Mode */
        .focus-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 8000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: focusFade 0.6s ease;
        }

        .focus-mode.active {
            display: flex;
        }

        @keyframes focusFade {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .focus-content {
            max-width: 600px;
            padding: var(--space-2xl);
            text-align: center;
            color: white;
        }

        .focus-task-title {
            font-size: 32px;
            margin-bottom: var(--space-xl);
            font-weight: 600;
        }

        .focus-timer {
            font-size: 64px;
            font-weight: 700;
            color: white;
            margin-bottom: var(--space-xl);
            font-variant-numeric: tabular-nums;
        }

        .breathing-circle {
            width: 100px;
            height: 100px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            margin: 0 auto var(--space-xl);
            animation: breathe 4s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 1; }
        }

        /* Responsive Design */
        /* Mobile First - Small devices */
        @media (max-width: 640px) {
            body {
                padding: 0;
            }

            .app-container {
                max-width: 100%;
                height: 100vh;
                border-radius: 0;
                border: none;
            }

            .welcome-title {
                font-size: 32px;
            }

            .welcome-tagline {
                font-size: 16px;
            }

            .welcome-logo {
                width: 80px;
                height: 80px;
                font-size: 36px;
            }

            .header {
                flex-direction: column;
                align-items: stretch;
                gap: var(--space-sm);
                padding: var(--space-md);
            }

            .greeting h1 {
                font-size: 20px;
            }

            .view-tabs {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: var(--space-xs);
                width: 100%;
            }

            .tab {
                padding: 8px 12px;
                font-size: 13px;
                justify-content: center;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }

            .main-content {
                padding: var(--space-md);
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: var(--space-sm);
            }

            .stat-card {
                padding: var(--space-md);
            }

            .stat-content h3 {
                font-size: 24px;
            }

            .quick-add {
                padding: var(--space-sm);
                flex-wrap: wrap;
            }

            .quick-add input {
                font-size: 15px;
            }

            .task {
                padding: var(--space-sm);
                flex-wrap: wrap;
            }

            .task-title {
                font-size: 14px;
            }

            .task-actions {
                opacity: 1;
            }

            .floating-timer {
                flex-direction: column;
                padding: var(--space-sm);
                text-align: center;
            }

            .timer-display {
                font-size: 24px;
            }

            .analytics-grid,
            .clients-grid {
                grid-template-columns: 1fr;
            }

            .reflection-stats {
                flex-direction: column;
                gap: var(--space-md);
            }

            .reflection h2 {
                font-size: 28px;
            }

            .reflection-stat h3 {
                font-size: 28px;
            }

            .focus-task-title {
                font-size: 24px;
            }

            .focus-timer {
                font-size: 48px;
            }

            .command-content {
                width: 95%;
                margin: 0 var(--space-sm);
            }

            .chart-label {
                width: 50px;
                font-size: 12px;
            }
        }

        /* Tablet - Medium devices */
        @media (min-width: 641px) and (max-width: 1024px) {
            .app-container {
                max-width: 95%;
                height: 95vh;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .view-tabs {
                flex-wrap: wrap;
            }

            .analytics-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .clients-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Desktop - Large devices */
        @media (min-width: 1025px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .analytics-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .clients-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            .task-actions {
                opacity: 1;
            }

            .icon-btn, .task-btn {
                min-width: 44px;
                min-height: 44px;
            }

            .tab {
                min-height: 44px;
            }
        }

        /* High DPI screens */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            body {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
        }

        /* Kanban Board */
        .board-container {
            display: flex;
            gap: var(--space-md);
            overflow-x: auto;
            padding-bottom: var(--space-md);
            height: 100%;
        }

        .board-column {
            min-width: 280px;
            max-width: 320px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            background: var(--gray-100);
            border-radius: var(--radius-md);
            padding: var(--space-md);
        }

        .board-column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-sm);
            border-bottom: 1px solid var(--gray-200);
        }

        .board-column-title {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-secondary);
        }

        .board-column-count {
            font-size: 11px;
            color: var(--color-text-secondary);
            background: var(--gray-200);
            padding: 2px 8px;
            border-radius: 10px;
        }

        .board-cards {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .board-card {
            background: var(--color-card);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            padding: var(--space-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .board-card:hover {
            border-color: var(--gray-300);
            transform: translateY(-2px);
        }

        .board-card.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .board-card-emoji {
            font-size: 20px;
            margin-bottom: var(--space-xs);
        }

        .board-card-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: var(--space-sm);
            line-height: 1.4;
        }

        .board-card-meta {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 11px;
            color: var(--color-text-secondary);
            flex-wrap: wrap;
        }

        .board-card-badge {
            padding: 2px 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            font-size: 10px;
        }

        .board-card-progress {
            width: 100%;
            height: 3px;
            background: var(--gray-200);
            border-radius: 2px;
            overflow: hidden;
            margin-top: var(--space-sm);
        }

        .board-card-progress-fill {
            height: 100%;
            background: white;
            transition: width var(--transition-normal);
        }

        /* Task Detail Modal */
        .task-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 9500;
            align-items: center;
            justify-content: center;
            padding: var(--space-lg);
        }

        .task-modal.active {
            display: flex;
            animation: modalFade 0.2s ease;
        }

        .task-modal-content {
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            background: var(--color-card);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: commandSlide 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .task-modal-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            gap: var(--space-md);
            align-items: flex-start;
        }

        .task-modal-emoji-picker {
            width: 50px;
            height: 50px;
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            transition: all var(--transition-fast);
            flex-shrink: 0;
        }

        .task-modal-emoji-picker:hover {
            background: var(--gray-200);
        }

        .task-modal-title-section {
            flex: 1;
            min-width: 0;
        }

        .task-modal-title-input {
            width: 100%;
            border: none;
            background: transparent;
            font-size: 24px;
            font-weight: 600;
            color: var(--color-text);
            outline: none;
            font-family: inherit;
            padding: 4px 0;
        }

        .task-modal-meta-row {
            display: flex;
            gap: var(--space-md);
            margin-top: var(--space-sm);
            flex-wrap: wrap;
        }

        .task-modal-meta-item {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            font-size: 13px;
            color: var(--color-text-secondary);
        }

        .task-modal-body {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-lg);
        }

        .task-modal-section {
            margin-bottom: var(--space-xl);
        }

        .task-modal-section-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-md);
        }

        .task-modal-textarea {
            width: 100%;
            min-height: 120px;
            padding: var(--space-md);
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            color: var(--color-text);
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            resize: vertical;
            outline: none;
            transition: all var(--transition-fast);
        }

        .task-modal-textarea:focus {
            border-color: var(--gray-300);
            background: var(--gray-50);
        }

        .task-modal-checkboxes {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .task-modal-checkbox-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm);
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .task-modal-checkbox-item:hover {
            background: var(--gray-200);
        }

        .task-modal-checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .task-modal-checkbox-item.completed {
            opacity: 0.5;
        }

        .task-modal-checkbox-item.completed span {
            text-decoration: line-through;
        }

        .task-modal-footer {
            padding: var(--space-lg);
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-modal-actions {
            display: flex;
            gap: var(--space-sm);
        }

        .task-modal-select {
            padding: 8px 12px;
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            color: var(--color-text);
            font-size: 13px;
            cursor: pointer;
            outline: none;
            transition: all var(--transition-fast);
        }

        .task-modal-select:hover {
            background: var(--gray-200);
        }

        .task-modal-input-small {
            width: 100px;
            padding: 8px 12px;
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            color: var(--color-text);
            font-size: 13px;
            outline: none;
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--gray-200);
            border-radius: 2px;
            overflow: hidden;
            margin: var(--space-sm) 0;
        }

        .progress-bar-fill {
            height: 100%;
            background: white;
            transition: width var(--transition-normal);
        }

        /* Emoji Picker Dropdown */
        .emoji-picker-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: var(--space-xs);
            padding: var(--space-sm);
            background: var(--color-card);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            max-width: 300px;
        }

        .emoji-picker-dropdown.active {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
        }

        .emoji-option {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            border-radius: 4px;
            transition: all var(--transition-fast);
        }

        .emoji-option:hover {
            background: var(--gray-200);
            transform: scale(1.1);
        }

        /* Onboarding Flow */
        .onboarding-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            z-index: 10001;
            align-items: center;
            justify-content: center;
            padding: var(--space-lg);
        }

        .onboarding-overlay.active {
            display: flex;
            animation: modalFade 0.3s ease;
        }

        .onboarding-content {
            width: 100%;
            max-width: 600px;
            background: var(--color-card);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            text-align: center;
            animation: commandSlide 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .onboarding-step {
            display: none;
        }

        .onboarding-step.active {
            display: block;
            animation: viewFadeIn var(--transition-normal);
        }

        .onboarding-progress {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: var(--space-xl);
        }

        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--gray-300);
            transition: all var(--transition-fast);
        }

        .progress-dot.active {
            width: 24px;
            border-radius: 4px;
            background: white;
        }

        .onboarding-icon {
            font-size: 64px;
            margin-bottom: var(--space-lg);
        }

        .onboarding-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: var(--space-md);
            letter-spacing: -0.02em;
        }

        .onboarding-subtitle {
            font-size: 16px;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-xl);
            line-height: 1.6;
        }

        .onboarding-input {
            width: 100%;
            padding: var(--space-md) var(--space-lg);
            background: var(--gray-100);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            color: var(--color-text);
            font-size: 18px;
            font-family: inherit;
            text-align: center;
            outline: none;
            transition: all var(--transition-fast);
            margin-bottom: var(--space-lg);
        }

        .onboarding-input:focus {
            border-color: white;
            background: var(--gray-50);
        }

        .role-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }

        .role-card {
            padding: var(--space-lg);
            background: var(--gray-100);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            text-align: center;
        }

        .role-card:hover {
            border-color: var(--gray-300);
            transform: translateY(-2px);
        }

        .role-card.selected {
            border-color: white;
            background: rgba(255, 255, 255, 0.05);
        }

        .role-icon {
            font-size: 32px;
            margin-bottom: var(--space-sm);
        }

        .role-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .role-desc {
            font-size: 13px;
            color: var(--color-text-secondary);
        }

        .goals-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            margin-bottom: var(--space-xl);
            text-align: left;
        }

        .goal-item {
            padding: var(--space-md);
            background: var(--gray-100);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .goal-item:hover {
            border-color: var(--gray-300);
        }

        .goal-item.selected {
            border-color: white;
            background: rgba(255, 255, 255, 0.05);
        }

        .goal-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--gray-400);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .goal-item.selected .goal-checkbox {
            background: white;
            border-color: white;
        }

        .goal-item.selected .goal-checkbox::after {
            content: '✓';
            color: black;
            font-weight: bold;
            font-size: 14px;
        }

        .feature-tour {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
            text-align: left;
        }

        .feature-item {
            padding: var(--space-md);
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
        }

        .feature-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .feature-content h4 {
            font-size: 15px;
            margin-bottom: 4px;
        }

        .feature-content p {
            font-size: 13px;
            color: var(--color-text-secondary);
            line-height: 1.5;
        }

        .onboarding-actions {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
        }

        .btn-large {
            padding: var(--space-md) var(--space-xl);
            font-size: 16px;
        }

        @media (max-width: 640px) {
            .role-grid {
                grid-template-columns: 1fr;
            }

            .onboarding-content {
                padding: var(--space-lg);
            }

            .onboarding-title {
                font-size: 24px;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Welcome Screen -->
    <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-logo">⚡</div>
        <h1 class="welcome-title">Followw</h1>
        <p class="welcome-tagline">work that moves with you.</p>
        <button class="welcome-button" onclick="startApp()">Get Started</button>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Header -->
        <div class="header">
            <div class="greeting">
                <h1 id="greeting">good morning.</h1>
                <p>let's get back in flow.</p>
            </div>

            <div class="view-tabs">
                <button class="tab active" data-view="today">
                    <span>☀️</span>
                    <span>today</span>
                </button>
                <button class="tab" data-view="board">
                    <span>📋</span>
                    <span>board</span>
                </button>
                <button class="tab" data-view="tasks">
                    <span>✓</span>
                    <span>tasks</span>
                </button>
                <button class="tab" data-view="clients">
                    <span>👥</span>
                    <span>clients</span>
                </button>
                <button class="tab" data-view="analytics">
                    <span>📊</span>
                    <span>analytics</span>
                </button>
            </div>

            <div class="header-actions">
                <span class="shortcut-hint">⌘K</span>
                <button class="icon-btn" onclick="toggleCommandPalette()" title="Command Palette">
                    <span>⌘</span>
                </button>
                <button class="icon-btn" onclick="toggleFocusMode()" title="Focus Mode">
                    <span>🎯</span>
                </button>
                <button class="icon-btn" onclick="exportData()" title="Export Data">
                    <span>⤓</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Today View -->
            <div id="today-view" class="view active">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card card">
                        <div class="stat-header">
                            <div class="stat-icon">⏱️</div>
                        </div>
                        <div class="stat-content">
                            <h3 id="stat-time">0h 0m</h3>
                            <p>focus time</p>
                            <div class="stat-trend">↑ 12% from yesterday</div>
                        </div>
                    </div>

                    <div class="stat-card card">
                        <div class="stat-header">
                            <div class="stat-icon">✓</div>
                        </div>
                        <div class="stat-content">
                            <h3 id="stat-completed">0</h3>
                            <p>completed</p>
                            <div class="stat-trend">🎯 focus tasks: <span id="focus-count">0</span></div>
                        </div>
                    </div>

                    <div class="stat-card card">
                        <div class="stat-header">
                            <div class="stat-icon">🔥</div>
                        </div>
                        <div class="stat-content">
                            <h3 id="stat-streak">0</h3>
                            <p>day streak</p>
                            <div class="stat-trend">Keep it going!</div>
                        </div>
                    </div>

                    <div class="stat-card card">
                        <div class="stat-header">
                            <div class="stat-icon">⚡</div>
                        </div>
                        <div class="stat-content">
                            <h3 id="flow-score">—</h3>
                            <p>flow score</p>
                            <div class="stat-trend" id="flow-rating">Start tracking</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Add -->
                <div class="quick-add card">
                    <div class="quick-add-icon">➕</div>
                    <input type="text" id="quick-add" placeholder="add task... (try 'Design pitch tomorrow' or 'Review PR #urgent friday')" />
                </div>

                <!-- Focus Tasks -->
                <div id="focus-section" class="tasks-section">
                    <div class="section-header">
                        <span class="section-title">🎯 focus</span>
                        <span class="section-count" id="focus-task-count">0</span>
                    </div>
                    <div id="focus-tasks"></div>
                </div>

                <!-- Supporting Tasks -->
                <div id="supporting-section" class="tasks-section">
                    <div class="section-header">
                        <span class="section-title">📋 supporting</span>
                        <span class="section-count" id="supporting-task-count">0</span>
                    </div>
                    <div id="supporting-tasks"></div>
                </div>

                <!-- Empty State -->
                <div id="empty-state" class="empty-state">
                    <div class="empty-icon">✨</div>
                    <h3>you're all caught up</h3>
                    <p>Start by adding your first task above.<br>
                    Try: "Design landing page" or "Review pull requests"</p>
                </div>

                <!-- Floating Timer -->
                <div id="floating-timer" class="floating-timer card">
                    <div class="timer-pulse"></div>
                    <div class="timer-info">
                        <div class="timer-task" id="timer-task-name">Task name</div>
                        <div class="timer-label">tracking time</div>
                    </div>
                    <div class="timer-display" id="timer-display">0:00</div>
                    <button class="timer-stop" onclick="stopTimer()">■</button>
                </div>
            </div>

            <!-- Board View -->
            <div id="board-view" class="view">
                <div class="board-container" id="boardContainer">
                    <!-- Columns will be dynamically generated -->
                </div>
            </div>

            <!-- All Tasks View -->
            <div id="tasks-view" class="view">
                <div class="section-header">
                    <h2 class="section-title" style="font-size: 20px;">all tasks</h2>
                    <button class="btn btn-secondary" onclick="filterTasks('all')">
                        <span id="task-filter-label">All Tasks</span>
                    </button>
                </div>
                <div id="all-tasks-list"></div>
                <div id="all-tasks-empty" class="empty-state hidden">
                    <div class="empty-icon">📝</div>
                    <h3>no tasks yet</h3>
                    <p>Create your first task to get started</p>
                </div>
            </div>

            <!-- Clients View -->
            <div id="clients-view" class="view">
                <div class="section-header">
                    <h2 class="section-title" style="font-size: 20px;">clients</h2>
                    <button class="btn btn-primary" onclick="addSampleClient()">
                        <span>+ Add Client</span>
                    </button>
                </div>
                <div class="clients-grid" id="clients-grid"></div>
                <div id="clients-empty" class="empty-state">
                    <div class="empty-icon">👥</div>
                    <h3>no clients yet</h3>
                    <p>Add clients to organize your work by customer or project owner</p>
                </div>
            </div>

            <!-- Analytics View -->
            <div id="analytics-view" class="view">
                <div class="analytics-grid">
                    <div class="analytics-card card">
                        <div class="analytics-header">
                            <h3 class="analytics-title">📈 this week</h3>
                        </div>
                        <div id="weekly-chart"></div>
                    </div>

                    <div class="analytics-card card">
                        <div class="analytics-header">
                            <h3 class="analytics-title">💡 insights</h3>
                        </div>
                        <div id="insights-list"></div>
                    </div>

                    <div class="analytics-card card">
                        <div class="analytics-header">
                            <h3 class="analytics-title">⚡ flow patterns</h3>
                        </div>
                        <div id="flow-patterns"></div>
                    </div>

                    <div class="analytics-card card">
                        <div class="analytics-header">
                            <h3 class="analytics-title">🎯 by client</h3>
                        </div>
                        <div id="client-breakdown"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Command Palette -->
    <div class="command-palette" id="commandPalette">
        <div class="command-content">
            <div class="command-input-wrapper">
                <span style="font-size: 20px;">⌘</span>
                <input type="text" class="command-input" id="commandInput" placeholder="Type a command..." />
            </div>
            <div class="command-results" id="commandResults"></div>
        </div>
    </div>

    <!-- Focus Mode -->
    <div class="focus-mode" id="focusMode">
        <div class="focus-content">
            <div class="breathing-circle"></div>
            <h2 class="focus-task-title" id="focusTaskTitle">Design Landing Page</h2>
            <div class="focus-timer" id="focusTimer">0:00</div>
            <button class="btn btn-primary" onclick="toggleFocusMode()">Exit Focus Mode</button>
        </div>
    </div>

    <!-- Task Detail Modal -->
    <div class="task-modal" id="taskModal">
        <div class="task-modal-content" onclick="event.stopPropagation()">
            <div class="task-modal-header">
                <div class="task-modal-emoji-picker" id="taskEmojiPicker" onclick="toggleEmojiPicker()">
                    <span id="taskEmoji">📝</span>
                </div>
                <div class="task-modal-title-section">
                    <input type="text" class="task-modal-title-input" id="taskModalTitle" placeholder="Task title..." />
                    <div class="task-modal-meta-row">
                        <div class="task-modal-meta-item">
                            <span>Created:</span>
                            <span id="taskCreatedDate">-</span>
                        </div>
                        <div class="task-modal-meta-item">
                            <span>Time spent:</span>
                            <span id="taskTimeSpent">0m</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="task-modal-body">
                <div class="task-modal-section">
                    <div class="task-modal-section-title">Description</div>
                    <textarea class="task-modal-textarea" id="taskModalNotes" placeholder="Add notes, links, or paste code...&#10;&#10;Supports markdown:&#10;- [ ] Checklist item&#10;- [x] Completed item&#10;&#10;```javascript&#10;// Code blocks&#10;```"></textarea>
                </div>

                <div class="task-modal-section">
                    <div class="task-modal-section-title">Subtasks (<span id="subtaskProgress">0/0</span>)</div>
                    <div class="task-modal-checkboxes" id="taskSubtasks">
                        <!-- Subtasks will be dynamically added -->
                    </div>
                    <button class="btn btn-secondary" style="margin-top: var(--space-sm);" onclick="addSubtask()">+ Add Subtask</button>
                </div>
            </div>

            <div class="task-modal-footer">
                <div class="task-modal-actions">
                    <select class="task-modal-select" id="taskModalStatus">
                        <option value="backlog">Backlog</option>
                        <option value="todo">To Do</option>
                        <option value="inprogress">In Progress</option>
                        <option value="completed">Completed</option>
                    </select>

                    <select class="task-modal-select" id="taskModalPriority">
                        <option value="low">Low</option>
                        <option value="normal">Normal</option>
                        <option value="high">High</option>
                    </select>

                    <input type="number" class="task-modal-input-small" id="taskModalEstimate" placeholder="Est. hours" min="0" step="0.5" />

                    <input type="date" class="task-modal-input-small" id="taskModalDueDate" style="width: 150px;" />
                </div>

                <div class="task-modal-actions">
                    <button class="btn btn-secondary" onclick="deleteTaskFromModal()">Delete</button>
                    <button class="btn btn-primary" onclick="closeTaskModal()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Onboarding Overlay -->
    <div class="onboarding-overlay" id="onboardingOverlay">
        <div class="onboarding-content">
            <!-- Progress Indicator -->
            <div class="onboarding-progress" id="onboardingProgress">
                <div class="progress-dot active"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
            </div>

            <!-- Step 1: Welcome & Name -->
            <div class="onboarding-step active" id="step-1">
                <div class="onboarding-icon">👋</div>
                <h2 class="onboarding-title">Welcome to Followw</h2>
                <p class="onboarding-subtitle">
                    The personal work OS that moves with you.<br>
                    Let's get you set up in 60 seconds.
                </p>
                <input
                    type="text"
                    class="onboarding-input"
                    id="userName"
                    placeholder="What's your name?"
                    autocomplete="off"
                />
                <div class="onboarding-actions">
                    <button class="btn btn-primary btn-large" onclick="nextOnboardingStep()">
                        Continue →
                    </button>
                </div>
            </div>

            <!-- Step 2: Role Selection -->
            <div class="onboarding-step" id="step-2">
                <div class="onboarding-icon">💼</div>
                <h2 class="onboarding-title">What best describes you?</h2>
                <p class="onboarding-subtitle">
                    We'll personalize your experience based on your role.
                </p>
                <div class="role-grid" id="roleGrid">
                    <div class="role-card" data-role="freelancer">
                        <div class="role-icon">🎯</div>
                        <div class="role-title">Freelancer</div>
                        <div class="role-desc">Track clients & billable hours</div>
                    </div>
                    <div class="role-card" data-role="developer">
                        <div class="role-icon">💻</div>
                        <div class="role-title">Developer</div>
                        <div class="role-desc">Manage sprints & code tasks</div>
                    </div>
                    <div class="role-card" data-role="designer">
                        <div class="role-icon">🎨</div>
                        <div class="role-title">Designer</div>
                        <div class="role-desc">Organize projects & reviews</div>
                    </div>
                    <div class="role-card" data-role="founder">
                        <div class="role-icon">🚀</div>
                        <div class="role-title">Founder</div>
                        <div class="role-desc">Build products & lead teams</div>
                    </div>
                    <div class="role-card" data-role="manager">
                        <div class="role-icon">📊</div>
                        <div class="role-title">Manager</div>
                        <div class="role-desc">Coordinate teams & workflows</div>
                    </div>
                    <div class="role-card" data-role="student">
                        <div class="role-icon">📚</div>
                        <div class="role-title">Student</div>
                        <div class="role-desc">Study plans & assignments</div>
                    </div>
                </div>
                <div class="onboarding-actions">
                    <button class="btn btn-secondary" onclick="prevOnboardingStep()">← Back</button>
                    <button class="btn btn-primary btn-large" onclick="nextOnboardingStep()" id="roleNextBtn" disabled>
                        Continue →
                    </button>
                </div>
            </div>

            <!-- Step 3: Goals -->
            <div class="onboarding-step" id="step-3">
                <div class="onboarding-icon">🎯</div>
                <h2 class="onboarding-title">What are your goals?</h2>
                <p class="onboarding-subtitle">
                    Select all that apply. We'll help you achieve them.
                </p>
                <div class="goals-list" id="goalsList">
                    <div class="goal-item" data-goal="focus">
                        <div class="goal-checkbox"></div>
                        <div style="flex: 1;">
                            <strong>Stay focused</strong> - Minimize distractions and get in flow
                        </div>
                    </div>
                    <div class="goal-item" data-goal="organize">
                        <div class="goal-checkbox"></div>
                        <div style="flex: 1;">
                            <strong>Get organized</strong> - Bring order to chaotic workload
                        </div>
                    </div>
                    <div class="goal-item" data-goal="track-time">
                        <div class="goal-checkbox"></div>
                        <div style="flex: 1;">
                            <strong>Track time</strong> - Know where your hours go
                        </div>
                    </div>
                    <div class="goal-item" data-goal="collaborate">
                        <div class="goal-checkbox"></div>
                        <div style="flex: 1;">
                            <strong>Collaborate better</strong> - Coordinate with clients/teams
                        </div>
                    </div>
                    <div class="goal-item" data-goal="productivity">
                        <div class="goal-checkbox"></div>
                        <div style="flex: 1;">
                            <strong>Boost productivity</strong> - Get more done in less time
                        </div>
                    </div>
                </div>
                <div class="onboarding-actions">
                    <button class="btn btn-secondary" onclick="prevOnboardingStep()">← Back</button>
                    <button class="btn btn-primary btn-large" onclick="nextOnboardingStep()">
                        Continue →
                    </button>
                </div>
            </div>

            <!-- Step 4: Feature Tour -->
            <div class="onboarding-step" id="step-4">
                <div class="onboarding-icon">✨</div>
                <h2 class="onboarding-title">Your new superpowers</h2>
                <p class="onboarding-subtitle">
                    Here's what makes Followw different.
                </p>
                <div class="feature-tour">
                    <div class="feature-item">
                        <div class="feature-icon">📋</div>
                        <div class="feature-content">
                            <h4>Kanban Board</h4>
                            <p>Drag tasks through Backlog → To Do → In Progress → Done. Visual workflow at a glance.</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">⌨️</div>
                        <div class="feature-content">
                            <h4>Keyboard Shortcuts</h4>
                            <p>⌘K for commands, ⌘1-5 to switch views, ⌘N for new tasks. Lightning fast.</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">🎯</div>
                        <div class="feature-content">
                            <h4>Focus Mode</h4>
                            <p>Deep work mode with breathing animation and timer. Block distractions completely.</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">💾</div>
                        <div class="feature-content">
                            <h4>Auto-Save</h4>
                            <p>Every 3 seconds with backup. Your work is always safe, even offline.</p>
                        </div>
                    </div>
                </div>
                <div class="onboarding-actions">
                    <button class="btn btn-secondary" onclick="prevOnboardingStep()">← Back</button>
                    <button class="btn btn-primary btn-large" onclick="completeOnboarding()">
                        Let's Go! 🚀
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reflection Overlay -->
    <div class="reflection" id="reflection">
        <div class="reflection-content">
            <div class="reflection-wave"></div>
            <h2>you've done enough for today.</h2>
            <div class="reflection-stats">
                <div class="reflection-stat">
                    <h3 id="reflection-time">0h 0m</h3>
                    <p>focus time</p>
                </div>
                <div class="reflection-stat">
                    <h3 id="reflection-tasks">0</h3>
                    <p>tasks completed</p>
                </div>
                <div class="reflection-stat">
                    <h3 id="reflection-flow">—</h3>
                    <p>flow score</p>
                </div>
            </div>
            <p class="reflection-insight" id="reflection-insight">
                Great work today. You maintained excellent focus and completed all your priorities.
            </p>
            <button class="reflection-close" onclick="closeReflection()">Continue</button>
        </div>
    </div>

    <script>
        // ===== FOLLOWW - COMPLETE APPLICATION =====

        const APP_VERSION = '1.0.0';
        const STORAGE_KEY = 'followw_data_v1';

        // State Management
        const state = {
            tasks: [],
            clients: [],
            activeTimer: null,
            timerInterval: null,
            currentView: 'today',
            focusMode: false,
            stats: {
                totalMinutes: 0,
                completed: 0,
                sessions: 0,
                streak: 0,
                flowScore: 0
            },
            settings: {
                theme: 'black',
                sounds: true,
                notifications: true,
                emailReminders: false,
                reminderEmail: '',
                autoSave: true,
                saveInterval: 3000 // 3 seconds
            },
            userProfile: {
                name: '',
                role: '',
                goals: [],
                onboardingCompleted: false,
                joinedDate: null
            },
            lastSaved: null,
            saveTimer: null
        };

        // Sample data
        const SAMPLE_CLIENTS = [
            { name: 'Acme Corp', color: '#3A76F0', tasks: 12, time: 240 },
            { name: 'TechStart', color: '#10B981', tasks: 8, time: 180 },
            { name: 'Design Studio', color: '#F59E0B', tasks: 15, time: 320 }
        ];

        const SAMPLE_TASKS = [
            'Design landing page for new product',
            'Review pull requests and merge',
            'Write documentation for API',
            'Plan Q2 roadmap meeting',
            'Update client presentation deck'
        ];

        const INSIGHTS = [
            "You're most productive between 9-11 AM. Schedule deep work then.",
            "Your focus sessions average 45 minutes. Try the Pomodoro technique.",
            "You completed all focus tasks this week. Excellent prioritization!",
            "Take more breaks to maintain energy throughout the day.",
            "Your flow score improved 23% this week. Keep it up!"
        ];

        // ===== INITIALIZATION =====

        function startApp() {
            const welcomeScreen = document.getElementById('welcomeScreen');
            const appContainer = document.getElementById('appContainer');

            welcomeScreen.classList.add('hidden');
            setTimeout(() => {
                appContainer.classList.add('visible');
                loadState();
                init();
            }, 600);
        }

        function init() {
            updateGreeting();
            renderAll();
            setupEventListeners();
            updateAnalytics();
            setInterval(updateGreeting, 60000);

            // Start auto-save
            startAutoSave();

            // Check if onboarding is needed
            if (!state.userProfile.onboardingCompleted) {
                // Show onboarding after welcome screen
                setTimeout(() => {
                    showOnboarding();
                }, 500);
            } else {
                // Add sample tasks if empty (for returning users)
                if (state.tasks.length === 0) {
                    SAMPLE_TASKS.slice(0, 3).forEach((title, i) => {
                        addTask(title, i < 2);
                    });
                }
            }

            // Request notification permission if reminders enabled
            if (state.settings.emailReminders && 'Notification' in window) {
                if (Notification.permission === 'default') {
                    Notification.requestPermission();
                }
            }

            // Check for overdue tasks and reschedule reminders
            state.tasks.forEach(task => {
                if (task.dueDate && !task.completed && !task.reminderSent) {
                    scheduleReminder(task);
                }
            });
        }

        // ===== STATE MANAGEMENT =====

        function loadState() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const data = JSON.parse(saved);
                    state.tasks = data.tasks || [];
                    state.clients = data.clients || SAMPLE_CLIENTS;
                    state.stats = data.stats || state.stats;
                    state.settings = { ...state.settings, ...(data.settings || {}) };
                    state.userProfile = { ...state.userProfile, ...(data.userProfile || {}) };
                } else {
                    state.clients = SAMPLE_CLIENTS;
                }

                // Try to restore from backup if main data is corrupted
                if (state.tasks.length === 0 && state.clients.length === 0) {
                    const backup = localStorage.getItem(STORAGE_KEY + '_backup');
                    if (backup) {
                        const backupData = JSON.parse(backup);
                        state.tasks = backupData.tasks || [];
                        state.clients = backupData.clients || SAMPLE_CLIENTS;
                        state.stats = backupData.stats || state.stats;
                        state.userProfile = { ...state.userProfile, ...(backupData.userProfile || {}) };
                        console.log('Restored from backup');
                    }
                }
            } catch (e) {
                console.error('Failed to load state:', e);
                // Try backup
                try {
                    const backup = localStorage.getItem(STORAGE_KEY + '_backup');
                    if (backup) {
                        const backupData = JSON.parse(backup);
                        state.tasks = backupData.tasks || [];
                        state.clients = backupData.clients || SAMPLE_CLIENTS;
                        state.stats = backupData.stats || state.stats;
                        state.userProfile = { ...state.userProfile, ...(backupData.userProfile || {}) };
                        console.log('Restored from backup after error');
                    }
                } catch (backupError) {
                    console.error('Backup restore also failed:', backupError);
                }
            }
        }

        function saveState() {
            try {
                const data = {
                    tasks: state.tasks,
                    clients: state.clients,
                    stats: state.stats,
                    settings: state.settings,
                    userProfile: state.userProfile,
                    timestamp: Date.now(),
                    version: APP_VERSION
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                state.lastSaved = Date.now();

                // Show save indicator
                showSaveIndicator();

                // Also save to backup key every 10 saves
                const saveCount = parseInt(localStorage.getItem('followw_save_count') || '0') + 1;
                localStorage.setItem('followw_save_count', saveCount.toString());

                if (saveCount % 10 === 0) {
                    localStorage.setItem(STORAGE_KEY + '_backup', JSON.stringify(data));
                }
            } catch (e) {
                console.error('Failed to save state:', e);
                showError('Failed to save data. Storage may be full.');
            }
        }

        function showSaveIndicator() {
            // Create or update save indicator
            let indicator = document.getElementById('save-indicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'save-indicator';
                indicator.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    padding: 8px 16px;
                    background: rgba(255, 255, 255, 0.1);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    border-radius: 8px;
                    color: white;
                    font-size: 12px;
                    opacity: 0;
                    transition: opacity 0.2s;
                    pointer-events: none;
                    z-index: 9999;
                `;
                document.body.appendChild(indicator);
            }

            const now = new Date();
            indicator.textContent = `Saved ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
            indicator.style.opacity = '1';

            setTimeout(() => {
                indicator.style.opacity = '0';
            }, 2000);
        }

        function showError(message) {
            alert(message);
        }

        // Auto-save functionality
        function startAutoSave() {
            if (state.settings.autoSave) {
                if (state.saveTimer) {
                    clearInterval(state.saveTimer);
                }

                state.saveTimer = setInterval(() => {
                    saveState();
                }, state.settings.saveInterval);
            }
        }

        function stopAutoSave() {
            if (state.saveTimer) {
                clearInterval(state.saveTimer);
                state.saveTimer = null;
            }
        }

        // ===== TASK OPERATIONS =====

        function addTask(title, isFocus = false, client = null, status = 'todo') {
            const dueDate = parseDueDate(title);
            const cleanTitle = dueDate ? cleanTaskTitle(title) : title;

            const task = {
                id: Date.now() + Math.random(),
                title: cleanTitle,
                emoji: getRandomEmoji(),
                isFocus,
                completed: false,
                status: status || (isFocus ? 'inprogress' : 'todo'), // backlog, todo, inprogress, completed
                client,
                tags: extractTags(cleanTitle),
                notes: '',
                createdAt: Date.now(),
                timeSpent: 0,
                project: null,
                dueDate: dueDate ? dueDate.getTime() : null,
                reminderSent: false,
                subtasks: [], // {id, text, completed}
                recurring: null,
                priority: isFocus ? 'high' : 'normal', // low, normal, high
                estimatedHours: null
            };

            state.tasks.push(task);
            saveState();
            renderAll();

            // Schedule reminder if due date exists
            if (dueDate && state.settings.emailReminders) {
                scheduleReminder(task);
            }

            // Confetti for first task
            if (state.tasks.length === 1 && typeof confetti !== 'undefined') {
                confetti({
                    particleCount: 50,
                    spread: 60,
                    origin: { y: 0.8 }
                });
            }
        }

        // Email Reminder System (simulated - would need backend in production)
        function scheduleReminder(task) {
            if (!task.dueDate || !state.settings.reminderEmail) return;

            const now = Date.now();
            const dueTime = task.dueDate;
            const reminderTime = dueTime - (24 * 60 * 60 * 1000); // 24 hours before

            if (reminderTime > now && !task.reminderSent) {
                // In production, this would call an API endpoint
                console.log(`Reminder scheduled for: ${task.title} at ${new Date(reminderTime)}`);

                // Show notification permission request
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }

                // Set browser notification for demo purposes
                const timeUntilReminder = reminderTime - now;
                if (timeUntilReminder < 24 * 60 * 60 * 1000) { // Within 24 hours
                    setTimeout(() => {
                        showTaskReminder(task);
                    }, timeUntilReminder);
                }
            }
        }

        function showTaskReminder(task) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('Followw Task Reminder', {
                    body: `"${task.title}" is due tomorrow`,
                    icon: '⚡',
                    tag: task.id
                });
            }

            // Also show in-app notification
            if (!task.reminderSent) {
                task.reminderSent = true;
                saveState();
            }
        }

        function extractTags(title) {
            const tags = [];
            const tagMatch = title.match(/#\w+/g);
            if (tagMatch) {
                tags.push(...tagMatch.map(t => t.slice(1)));
            }
            return tags;
        }

        // Natural Language Date Parser
        function parseDueDate(text) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const patterns = [
                { regex: /\btoday\b/i, offset: 0 },
                { regex: /\btomorrow\b/i, offset: 1 },
                { regex: /\bmonday\b/i, day: 1 },
                { regex: /\btuesday\b/i, day: 2 },
                { regex: /\bwednesday\b/i, day: 3 },
                { regex: /\bthursday\b/i, day: 4 },
                { regex: /\bfriday\b/i, day: 5 },
                { regex: /\bsaturday\b/i, day: 6 },
                { regex: /\bsunday\b/i, day: 0 },
                { regex: /\bin (\d+) days?\b/i, capture: true },
                { regex: /\bnext week\b/i, offset: 7 }
            ];

            for (const pattern of patterns) {
                const match = text.match(pattern.regex);
                if (match) {
                    if (pattern.offset !== undefined) {
                        const date = new Date(today);
                        date.setDate(date.getDate() + pattern.offset);
                        return date;
                    } else if (pattern.day !== undefined) {
                        const date = new Date(today);
                        const currentDay = date.getDay();
                        let diff = pattern.day - currentDay;
                        if (diff <= 0) diff += 7;
                        date.setDate(date.getDate() + diff);
                        return date;
                    } else if (pattern.capture) {
                        const days = parseInt(match[1]);
                        const date = new Date(today);
                        date.setDate(date.getDate() + days);
                        return date;
                    }
                }
            }

            return null;
        }

        function cleanTaskTitle(title) {
            // Remove date patterns from title
            return title
                .replace(/\b(today|tomorrow|monday|tuesday|wednesday|thursday|friday|saturday|sunday)\b/gi, '')
                .replace(/\bin \d+ days?\b/gi, '')
                .replace(/\bnext week\b/gi, '')
                .replace(/\s+/g, ' ')
                .trim();
        }

        function toggleComplete(id) {
            const task = state.tasks.find(t => t.id === id);
            if (!task) return;

            task.completed = !task.completed;

            if (task.completed) {
                state.stats.completed++;

                // Confetti celebration
                if (typeof confetti !== 'undefined') {
                    confetti({
                        particleCount: 100,
                        spread: 70,
                        origin: { y: 0.6 }
                    });
                }

                if (shouldShowReflection()) {
                    setTimeout(showReflection, 800);
                }
            } else {
                state.stats.completed = Math.max(0, state.stats.completed - 1);
            }

            saveState();
            renderAll();
            updateFlowScore();
        }

        function deleteTask(id) {
            state.tasks = state.tasks.filter(t => t.id !== id);
            saveState();
            renderAll();
        }

        // ===== TIMER OPERATIONS =====

        function startTimer(taskId) {
            const task = state.tasks.find(t => t.id === taskId);
            if (!task) return;

            if (state.activeTimer) {
                stopTimer();
            }

            state.activeTimer = {
                taskId,
                startTime: Date.now()
            };

            state.stats.sessions++;

            state.timerInterval = setInterval(() => {
                updateTimerDisplay();
            }, 1000);

            renderAll();
            updateFloatingTimer();
        }

        function stopTimer() {
            if (!state.activeTimer) return;

            const elapsed = Date.now() - state.activeTimer.startTime;
            const task = state.tasks.find(t => t.id === state.activeTimer.taskId);

            if (task) {
                task.timeSpent += elapsed;
            }

            const minutes = Math.floor(elapsed / 60000);
            state.stats.totalMinutes += minutes;

            clearInterval(state.timerInterval);
            state.activeTimer = null;
            state.timerInterval = null;

            saveState();
            renderAll();
            updateFloatingTimer();
            updateFlowScore();
        }

        function updateTimerDisplay() {
            if (!state.activeTimer) return;

            const elapsed = Date.now() - state.activeTimer.startTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);

            const display = document.getElementById('timer-display');
            const focusDisplay = document.getElementById('focusTimer');

            const timeStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            if (display) display.textContent = timeStr;
            if (focusDisplay) focusDisplay.textContent = timeStr;
        }

        function updateFloatingTimer() {
            const timer = document.getElementById('floating-timer');

            if (state.activeTimer) {
                const task = state.tasks.find(t => t.id === state.activeTimer.taskId);
                if (task) {
                    document.getElementById('timer-task-name').textContent = task.title;
                    timer.classList.add('active');
                }
            } else {
                timer.classList.remove('active');
            }
        }

        // ===== RENDERING =====

        function renderAll() {
            renderTasks();
            renderBoard();
            updateStats();
            renderClients();
            updateAnalytics();
        }

        function renderTasks() {
            const focusTasks = state.tasks.filter(t => !t.completed && t.isFocus);
            const supportingTasks = state.tasks.filter(t => !t.completed && !t.isFocus);
            const allTasks = state.tasks;

            // Today view
            renderTaskList(focusTasks, 'focus-tasks');
            renderTaskList(supportingTasks, 'supporting-tasks');

            document.getElementById('focus-task-count').textContent = focusTasks.length;
            document.getElementById('supporting-task-count').textContent = supportingTasks.length;

            const hasToday = focusTasks.length > 0 || supportingTasks.length > 0;
            document.getElementById('empty-state').classList.toggle('hidden', hasToday);
            document.getElementById('focus-section').classList.toggle('hidden', focusTasks.length === 0);
            document.getElementById('supporting-section').classList.toggle('hidden', supportingTasks.length === 0);

            // All tasks view
            renderTaskList(allTasks, 'all-tasks-list');
            document.getElementById('all-tasks-empty').classList.toggle('hidden', allTasks.length > 0);
        }

        function renderTaskList(tasks, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            container.innerHTML = '';

            tasks.forEach(task => {
                const div = document.createElement('div');
                div.className = 'task card' + (task.completed ? ' completed' : '') + (task.isFocus ? ' focus' : '');

                const isTimerActive = state.activeTimer?.taskId === task.id;

                const dueDateHtml = task.dueDate ? formatDueDate(task.dueDate) : '';

                div.innerHTML = `
                    <div class="checkbox" onclick="toggleComplete(${task.id})"></div>
                    <div class="task-content" onclick="openTaskDetail(${task.id})">
                        <div class="task-title">${escapeHtml(task.title)}</div>
                        <div class="task-meta">
                            ${task.client ? `<span class="task-client">@${task.client}</span>` : ''}
                            ${task.tags.map(tag => `<span class="task-tag">#${tag}</span>`).join('')}
                            ${dueDateHtml}
                            ${task.timeSpent > 0 ? `<span class="task-time">⏱️ ${formatTime(task.timeSpent)}</span>` : ''}
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="task-btn ${isTimerActive ? 'active' : ''}" onclick="toggleTimer(event, ${task.id})" title="${isTimerActive ? 'Stop timer' : 'Start timer'}">
                            ${isTimerActive ? '■' : '▶'}
                        </button>
                        <button class="task-btn" onclick="deleteTask(${task.id})" title="Delete task">
                            🗑️
                        </button>
                    </div>
                `;

                container.appendChild(div);
            });
        }

        function renderClients() {
            const container = document.getElementById('clients-grid');
            const empty = document.getElementById('clients-empty');

            if (state.clients.length === 0) {
                empty.classList.remove('hidden');
                container.classList.add('hidden');
                return;
            }

            empty.classList.add('hidden');
            container.classList.remove('hidden');
            container.innerHTML = '';

            state.clients.forEach(client => {
                const div = document.createElement('div');
                div.className = 'client-card card';

                div.innerHTML = `
                    <div class="client-header">
                        <div class="client-avatar" style="background: ${client.color}">
                            ${client.name[0]}
                        </div>
                        <div class="client-info">
                            <h3>${client.name}</h3>
                            <p>${client.tasks} tasks</p>
                        </div>
                    </div>
                    <div class="client-stats">
                        <div class="client-stat">
                            <div class="client-stat-value">${formatMinutes(client.time)}</div>
                            <div class="client-stat-label">time</div>
                        </div>
                        <div class="client-stat">
                            <div class="client-stat-value">${client.tasks}</div>
                            <div class="client-stat-label">tasks</div>
                        </div>
                    </div>
                `;

                container.appendChild(div);
            });
        }

        function updateStats() {
            const hours = Math.floor(state.stats.totalMinutes / 60);
            const minutes = state.stats.totalMinutes % 60;
            const timeText = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;

            document.getElementById('stat-time').textContent = timeText;
            document.getElementById('stat-completed').textContent = state.stats.completed;
            document.getElementById('focus-count').textContent = state.tasks.filter(t => !t.completed && t.isFocus).length;
            document.getElementById('stat-streak').textContent = state.stats.streak || Math.floor(state.stats.completed / 5);

            const flowScore = calculateFlowScore();
            document.getElementById('flow-score').textContent = flowScore > 0 ? flowScore : '—';
            document.getElementById('flow-rating').textContent = getFlowRating(flowScore);
        }

        function updateAnalytics() {
            // Weekly chart
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const weeklyChart = document.getElementById('weekly-chart');
            if (!weeklyChart) return;

            weeklyChart.innerHTML = '';

            days.forEach((day, i) => {
                const value = i === new Date().getDay() ? state.stats.totalMinutes : Math.floor(Math.random() * 180);
                const maxValue = 240;
                const percentage = Math.min((value / maxValue) * 100, 100);

                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.innerHTML = `
                    <div class="chart-label">${day}</div>
                    <div class="chart-track">
                        <div class="chart-fill" style="width: ${percentage}%">
                            ${value > 20 ? value + 'm' : ''}
                        </div>
                    </div>
                    <div class="chart-value">${value}m</div>
                `;
                weeklyChart.appendChild(bar);
            });

            // Insights
            const insightsList = document.getElementById('insights-list');
            if (insightsList) {
                insightsList.innerHTML = '';

                const insights = state.stats.totalMinutes > 0 ?
                    INSIGHTS.slice(0, 3) :
                    ["Start tracking time to see personalized insights about your productivity patterns."];

                insights.forEach(insight => {
                    const item = document.createElement('div');
                    item.className = 'insight-item';
                    item.innerHTML = `
                        <div class="insight-icon">💡</div>
                        <div class="insight-text">${insight}</div>
                    `;
                    insightsList.appendChild(item);
                });
            }

            // Flow patterns
            const flowPatterns = document.getElementById('flow-patterns');
            if (flowPatterns) {
                const avgSession = state.stats.sessions > 0 ?
                    Math.floor(state.stats.totalMinutes / state.stats.sessions) : 0;

                flowPatterns.innerHTML = `
                    <div class="insight-item">
                        <div class="insight-icon">⏱️</div>
                        <div class="insight-text">Average session: ${avgSession} minutes</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-icon">🎯</div>
                        <div class="insight-text">Peak focus: ${state.stats.totalMinutes > 60 ? 'Mornings' : 'Track more to see'}</div>
                    </div>
                `;
            }

            // Client breakdown
            const clientBreakdown = document.getElementById('client-breakdown');
            if (clientBreakdown) {
                clientBreakdown.innerHTML = '';

                state.clients.slice(0, 5).forEach(client => {
                    const bar = document.createElement('div');
                    bar.className = 'chart-bar';
                    bar.innerHTML = `
                        <div class="chart-label">${client.name}</div>
                        <div class="chart-track">
                            <div class="chart-fill" style="width: ${(client.time / 400) * 100}%"></div>
                        </div>
                        <div class="chart-value">${formatMinutes(client.time)}</div>
                    `;
                    clientBreakdown.appendChild(bar);
                });
            }
        }

        // ===== FLOW SCORE CALCULATION =====

        function calculateFlowScore() {
            if (state.stats.totalMinutes === 0) return 0;

            const timeScore = Math.min(state.stats.totalMinutes / 180, 1);
            const completionScore = Math.min(state.stats.completed / 5, 1);
            const consistencyScore = state.stats.sessions > 0 ? Math.min(state.stats.totalMinutes / (state.stats.sessions * 30), 1) : 0;

            const score = ((timeScore * 0.4) + (completionScore * 0.4) + (consistencyScore * 0.2)) * 100;

            return Math.round(score);
        }

        function getFlowRating(score) {
            if (score === 0) return 'Start tracking';
            if (score < 30) return '🌱 Building';
            if (score < 60) return '🔥 Good flow';
            if (score < 85) return '⚡ Great flow';
            return '🚀 Peak flow';
        }

        function updateFlowScore() {
            const score = calculateFlowScore();
            state.stats.flowScore = score;
            saveState();
            updateStats();
        }

        // ===== UI INTERACTIONS =====

        function toggleTimer(event, taskId) {
            event.stopPropagation();

            if (state.activeTimer?.taskId === taskId) {
                stopTimer();
            } else {
                startTimer(taskId);
            }
        }

        function openTaskDetail(taskId) {
            openTaskModal(taskId);
        }

        function toggleFocusMode() {
            const focusMode = document.getElementById('focusMode');
            focusMode.classList.toggle('active');
            state.focusMode = focusMode.classList.contains('active');

            if (state.focusMode && state.activeTimer) {
                const task = state.tasks.find(t => t.id === state.activeTimer.taskId);
                if (task) {
                    document.getElementById('focusTaskTitle').textContent = task.title;
                }
            }
        }

        function toggleCommandPalette() {
            const palette = document.getElementById('commandPalette');
            const isActive = palette.classList.contains('active');

            if (isActive) {
                palette.classList.remove('active');
            } else {
                palette.classList.add('active');
                document.getElementById('commandInput').focus();
                renderCommandResults();
            }
        }

        function renderCommandResults() {
            const results = document.getElementById('commandResults');

            const commands = [
                { icon: '➕', title: 'Add Task', desc: 'Create a new task • ⌘N', action: 'addTask' },
                { icon: '📋', title: 'Board View', desc: 'Kanban board • ⌘2', action: 'board' },
                { icon: '🎯', title: 'Focus Mode', desc: 'Enter deep focus • ⌘F', action: 'focusMode' },
                { icon: '📊', title: 'View Analytics', desc: 'See your stats • ⌘5', action: 'analytics' },
                { icon: '⤓', title: 'Export Data', desc: 'Download your data', action: 'export' },
                { icon: '⚡', title: 'Keyboard Shortcuts', desc: 'View all shortcuts', action: 'shortcuts' }
            ];

            results.innerHTML = '';

            commands.forEach((cmd, i) => {
                const item = document.createElement('div');
                item.className = 'command-item' + (i === 0 ? ' selected' : '');
                item.innerHTML = `
                    <div class="command-icon">${cmd.icon}</div>
                    <div class="command-item-content">
                        <h4>${cmd.title}</h4>
                        <p>${cmd.desc}</p>
                    </div>
                `;
                item.onclick = () => executeCommand(cmd.action);
                results.appendChild(item);
            });
        }

        function executeCommand(action) {
            toggleCommandPalette();

            switch(action) {
                case 'addTask':
                    document.getElementById('quick-add').focus();
                    break;
                case 'board':
                    switchView('board');
                    break;
                case 'focusMode':
                    toggleFocusMode();
                    break;
                case 'analytics':
                    switchView('analytics');
                    break;
                case 'export':
                    exportData();
                    break;
                case 'shortcuts':
                    showKeyboardShortcuts();
                    break;
            }
        }

        function showKeyboardShortcuts() {
            const shortcuts = `
Keyboard Shortcuts:

⌘K - Command Palette
⌘N - New Task
⌘F - Focus Mode
⌘1 - Today View
⌘2 - Board View (Kanban)
⌘3 - All Tasks
⌘4 - Clients
⌘5 - Analytics
Esc - Close Overlays

All shortcuts work with Ctrl on Windows/Linux.

Board View Features:
- Drag & drop tasks between columns
- Click any card to view details
- Add subtasks & checklists
- Set priorities & estimates
            `.trim();

            alert(shortcuts);
        }

        function exportData() {
            const data = {
                version: APP_VERSION,
                exportedAt: new Date().toISOString(),
                tasks: state.tasks,
                clients: state.clients,
                stats: state.stats
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `followw-export-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);

            alert('Data exported successfully! 📊');
        }

        // ===== REFLECTION =====

        function shouldShowReflection() {
            const todayTasks = state.tasks.filter(t => !t.completed);
            return todayTasks.length === 0 && state.tasks.length > 0 && state.stats.totalMinutes > 30;
        }

        function showReflection() {
            const reflection = document.getElementById('reflection');
            reflection.classList.add('active');

            const hours = Math.floor(state.stats.totalMinutes / 60);
            const minutes = state.stats.totalMinutes % 60;

            document.getElementById('reflection-time').textContent = `${hours}h ${minutes}m`;
            document.getElementById('reflection-tasks').textContent = state.stats.completed;
            document.getElementById('reflection-flow').textContent = state.stats.flowScore || '—';

            const insights = [
                "You maintained excellent focus throughout the day.",
                "Great work on completing all your priorities.",
                "Your consistency is building strong momentum.",
                "You're making meaningful progress every day.",
                "Keep up this excellent work rhythm."
            ];

            document.getElementById('reflection-insight').textContent =
                insights[Math.floor(Math.random() * insights.length)];
        }

        function closeReflection() {
            document.getElementById('reflection').classList.remove('active');
        }

        // ===== VIEW SWITCHING =====

        function switchView(viewName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.view === viewName);
            });

            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });

            document.getElementById(`${viewName}-view`).classList.add('active');
            state.currentView = viewName;

            if (viewName === 'analytics') {
                updateAnalytics();
            }
        }

        // ===== EVENT LISTENERS =====

        function setupEventListeners() {
            document.getElementById('quick-add').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && e.target.value.trim()) {
                    const value = e.target.value.trim();
                    const isFocus = state.tasks.filter(t => t.isFocus && !t.completed).length < 3;
                    addTask(value, isFocus);
                    e.target.value = '';
                }
            });

            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => switchView(tab.dataset.view));
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Command palette: Cmd/Ctrl+K
                if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                    e.preventDefault();
                    toggleCommandPalette();
                }

                // Focus mode: Cmd/Ctrl+F
                if ((e.metaKey || e.ctrlKey) && e.key === 'f' && !e.shiftKey) {
                    e.preventDefault();
                    toggleFocusMode();
                }

                // Quick add: Cmd/Ctrl+N
                if ((e.metaKey || e.ctrlKey) && e.key === 'n') {
                    e.preventDefault();
                    document.getElementById('quick-add').focus();
                }

                // View switching: Cmd/Ctrl+1,2,3,4,5
                if ((e.metaKey || e.ctrlKey) && ['1', '2', '3', '4', '5'].includes(e.key)) {
                    e.preventDefault();
                    const views = ['today', 'board', 'tasks', 'clients', 'analytics'];
                    switchView(views[parseInt(e.key) - 1]);
                }

                // Escape: Close overlays
                if (e.key === 'Escape') {
                    const palette = document.getElementById('commandPalette');
                    const focusMode = document.getElementById('focusMode');
                    const reflection = document.getElementById('reflection');
                    const taskModal = document.getElementById('taskModal');

                    if (taskModal.classList.contains('active')) {
                        closeTaskModal();
                    } else if (palette.classList.contains('active')) {
                        toggleCommandPalette();
                    } else if (focusMode.classList.contains('active')) {
                        toggleFocusMode();
                    } else if (reflection.classList.contains('active')) {
                        closeReflection();
                    }
                }
            });

            document.getElementById('commandPalette').addEventListener('click', (e) => {
                if (e.target.id === 'commandPalette') {
                    toggleCommandPalette();
                }
            });
        }

        // ===== HELPERS =====

        function updateGreeting() {
            const hour = new Date().getHours();
            let greeting;

            if (hour < 12) greeting = 'good morning';
            else if (hour < 17) greeting = 'good afternoon';
            else if (hour < 21) greeting = 'good evening';
            else greeting = 'good night';

            // Personalize if user has completed onboarding
            if (state.userProfile.name && state.userProfile.onboardingCompleted) {
                greeting += `, ${state.userProfile.name}`;
            }

            greeting += '.';

            document.getElementById('greeting').textContent = greeting;
        }

        function formatTime(ms) {
            const minutes = Math.floor(ms / 60000);
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;

            if (hours > 0) {
                return `${hours}h ${mins}m`;
            }
            return `${mins}m`;
        }

        function formatMinutes(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;

            if (hours > 0) {
                return `${hours}h ${mins}m`;
            }
            return `${mins}m`;
        }

        function formatDueDate(timestamp) {
            const date = new Date(timestamp);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const dueDay = new Date(date);
            dueDay.setHours(0, 0, 0, 0);

            const diffTime = dueDay - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            let color = 'var(--color-text-secondary)';
            let text = '';

            if (diffDays < 0) {
                color = 'var(--color-error)';
                text = 'Overdue';
            } else if (diffDays === 0) {
                color = 'var(--color-warning)';
                text = 'Due today';
            } else if (diffDays === 1) {
                text = 'Due tomorrow';
            } else if (diffDays <= 7) {
                text = `Due in ${diffDays} days`;
            } else {
                const options = { month: 'short', day: 'numeric' };
                text = `Due ${date.toLocaleDateString('en-US', options)}`;
            }

            return `<span class="task-due" style="color: ${color}">📅 ${text}</span>`;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function addSampleClient() {
            const names = ['Startup Inc', 'Enterprise Co', 'Agency XYZ', 'Product Labs'];
            const colors = ['#3A76F0', '#10B981', '#F59E0B', '#EF476F'];

            const client = {
                name: names[Math.floor(Math.random() * names.length)],
                color: colors[Math.floor(Math.random() * colors.length)],
                tasks: Math.floor(Math.random() * 15) + 5,
                time: Math.floor(Math.random() * 300) + 100
            };

            state.clients.push(client);
            saveState();
            renderClients();
        }

        function filterTasks(filter) {
            console.log('Filtering tasks:', filter);
        }

        // ===== BOARD VIEW =====

        const BOARD_COLUMNS = [
            { id: 'backlog', title: 'Backlog', icon: '📥' },
            { id: 'todo', title: 'To Do', icon: '📝' },
            { id: 'inprogress', title: 'In Progress', icon: '⚡' },
            { id: 'completed', title: 'Completed', icon: '✅' }
        ];

        function renderBoard() {
            const container = document.getElementById('boardContainer');
            if (!container) return;

            container.innerHTML = '';

            BOARD_COLUMNS.forEach(column => {
                const tasks = state.tasks.filter(t => t.status === column.id);

                const columnDiv = document.createElement('div');
                columnDiv.className = 'board-column';
                columnDiv.dataset.status = column.id;

                columnDiv.innerHTML = `
                    <div class="board-column-header">
                        <div class="board-column-title">${column.icon} ${column.title}</div>
                        <div class="board-column-count">${tasks.length}</div>
                    </div>
                    <div class="board-cards" id="cards-${column.id}"></div>
                `;

                container.appendChild(columnDiv);

                // Render cards
                const cardsContainer = columnDiv.querySelector('.board-cards');
                tasks.forEach(task => {
                    const card = createBoardCard(task);
                    cardsContainer.appendChild(card);
                });

                // Setup drop zone
                setupDropZone(cardsContainer, column.id);
            });
        }

        function createBoardCard(task) {
            const div = document.createElement('div');
            div.className = 'board-card';
            div.draggable = true;
            div.dataset.taskId = task.id;

            const progress = task.subtasks.length > 0 ?
                (task.subtasks.filter(st => st.completed).length / task.subtasks.length * 100) : 0;

            const metaItems = [];
            if (task.client) metaItems.push(`<span class="board-card-badge">@${task.client}</span>`);
            if (task.priority !== 'normal') {
                metaItems.push(`<span class="board-card-badge">${task.priority}</span>`);
            }
            if (task.estimatedHours) metaItems.push(`<span>⏱️ ${task.estimatedHours}h</span>`);
            if (task.dueDate) {
                const daysUntil = Math.ceil((task.dueDate - Date.now()) / (1000 * 60 * 60 * 24));
                if (daysUntil <= 3) metaItems.push(`<span>📅 ${daysUntil}d</span>`);
            }

            div.innerHTML = `
                ${task.emoji ? `<div class="board-card-emoji">${task.emoji}</div>` : ''}
                <div class="board-card-title">${escapeHtml(task.title)}</div>
                <div class="board-card-meta">
                    ${metaItems.join('')}
                    ${task.subtasks.length > 0 ? `<span>☑️ ${task.subtasks.filter(st => st.completed).length}/${task.subtasks.length}</span>` : ''}
                </div>
                ${task.subtasks.length > 0 ? `
                    <div class="board-card-progress">
                        <div class="board-card-progress-fill" style="width: ${progress}%"></div>
                    </div>
                ` : ''}
            `;

            // Click to open modal
            div.addEventListener('click', () => openTaskModal(task.id));

            // Drag events
            div.addEventListener('dragstart', (e) => {
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('taskId', task.id);
                div.classList.add('dragging');
            });

            div.addEventListener('dragend', () => {
                div.classList.remove('dragging');
            });

            return div;
        }

        function setupDropZone(container, status) {
            container.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            });

            container.addEventListener('drop', (e) => {
                e.preventDefault();
                const taskId = parseFloat(e.dataTransfer.getData('taskId'));
                const task = state.tasks.find(t => t.id === taskId);

                if (task && task.status !== status) {
                    task.status = status;
                    if (status === 'completed') {
                        task.completed = true;
                        state.stats.completed++;
                    } else if (task.completed) {
                        task.completed = false;
                        state.stats.completed = Math.max(0, state.stats.completed - 1);
                    }
                    saveState();
                    renderBoard();
                    updateStats();
                }
            });
        }

        // ===== TASK MODAL =====

        let currentTaskId = null;

        function openTaskModal(taskId) {
            const task = state.tasks.find(t => t.id === taskId);
            if (!task) return;

            currentTaskId = taskId;

            // Populate modal
            document.getElementById('taskModalTitle').value = task.title;
            document.getElementById('taskEmoji').textContent = task.emoji || '📝';
            document.getElementById('taskModalNotes').value = task.notes || '';
            document.getElementById('taskModalStatus').value = task.status;
            document.getElementById('taskModalPriority').value = task.priority;
            document.getElementById('taskModalEstimate').value = task.estimatedHours || '';

            if (task.dueDate) {
                const date = new Date(task.dueDate);
                document.getElementById('taskModalDueDate').value = date.toISOString().split('T')[0];
            } else {
                document.getElementById('taskModalDueDate').value = '';
            }

            document.getElementById('taskCreatedDate').textContent =
                new Date(task.createdAt).toLocaleDateString();
            document.getElementById('taskTimeSpent').textContent = formatTime(task.timeSpent);

            renderSubtasks(task);

            document.getElementById('taskModal').classList.add('active');
        }

        function closeTaskModal() {
            if (!currentTaskId) return;

            const task = state.tasks.find(t => t.id === currentTaskId);
            if (task) {
                // Save changes
                task.title = document.getElementById('taskModalTitle').value;
                task.notes = document.getElementById('taskModalNotes').value;
                task.status = document.getElementById('taskModalStatus').value;
                task.priority = document.getElementById('taskModalPriority').value;
                task.estimatedHours = parseFloat(document.getElementById('taskModalEstimate').value) || null;

                const dueDateValue = document.getElementById('taskModalDueDate').value;
                task.dueDate = dueDateValue ? new Date(dueDateValue).getTime() : null;

                saveState();
                renderAll();
            }

            document.getElementById('taskModal').classList.remove('active');
            currentTaskId = null;
        }

        function deleteTaskFromModal() {
            if (currentTaskId && confirm('Delete this task?')) {
                deleteTask(currentTaskId);
                closeTaskModal();
            }
        }

        // Subtasks
        function renderSubtasks(task) {
            const container = document.getElementById('taskSubtasks');
            container.innerHTML = '';

            if (!task.subtasks) task.subtasks = [];

            task.subtasks.forEach((subtask, index) => {
                const div = document.createElement('div');
                div.className = 'task-modal-checkbox-item' + (subtask.completed ? ' completed' : '');

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = subtask.completed;
                checkbox.onchange = () => toggleSubtask(task.id, index);

                const span = document.createElement('span');
                span.textContent = subtask.text;
                span.style.flex = '1';

                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = '×';
                deleteBtn.className = 'icon-btn';
                deleteBtn.style.cssText = 'width: 24px; height: 24px; font-size: 18px;';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    removeSubtask(task.id, index);
                };

                div.appendChild(checkbox);
                div.appendChild(span);
                div.appendChild(deleteBtn);

                container.appendChild(div);
            });

            updateSubtaskProgress(task);
        }

        function addSubtask() {
            const task = state.tasks.find(t => t.id === currentTaskId);
            if (!task) return;

            const text = prompt('Subtask:');
            if (!text) return;

            if (!task.subtasks) task.subtasks = [];
            task.subtasks.push({
                id: Date.now() + Math.random(),
                text,
                completed: false
            });

            saveState();
            renderSubtasks(task);
        }

        function toggleSubtask(taskId, index) {
            const task = state.tasks.find(t => t.id === taskId);
            if (!task || !task.subtasks[index]) return;

            task.subtasks[index].completed = !task.subtasks[index].completed;
            saveState();
            renderSubtasks(task);
            renderBoard();
        }

        function removeSubtask(taskId, index) {
            const task = state.tasks.find(t => t.id === taskId);
            if (!task || !task.subtasks[index]) return;

            task.subtasks.splice(index, 1);
            saveState();
            renderSubtasks(task);
        }

        function updateSubtaskProgress(task) {
            if (!task.subtasks || task.subtasks.length === 0) {
                document.getElementById('subtaskProgress').textContent = '0/0';
                return;
            }

            const completed = task.subtasks.filter(st => st.completed).length;
            document.getElementById('subtaskProgress').textContent = `${completed}/${task.subtasks.length}`;
        }

        // Emoji picker
        const EMOJIS = ['📝', '💡', '🎯', '⚡', '🔥', '✨', '🚀', '💻', '🎨', '📊', '🔧', '📱', '🌟', '💼', '📈', '🎉'];

        function getRandomEmoji() {
            return EMOJIS[Math.floor(Math.random() * EMOJIS.length)];
        }

        function toggleEmojiPicker() {
            // Simple emoji change for now
            const task = state.tasks.find(t => t.id === currentTaskId);
            if (!task) return;

            const currentIndex = EMOJIS.indexOf(task.emoji);
            const nextIndex = (currentIndex + 1) % EMOJIS.length;
            task.emoji = EMOJIS[nextIndex];

            document.getElementById('taskEmoji').textContent = task.emoji;
            saveState();
            renderBoard();
        }

        // Close modal on background click
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById('taskModal');
            if (modal) {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeTaskModal();
                    }
                });
            }

            // Setup onboarding interactions
            setupOnboardingInteractions();
        });

        // ===== ONBOARDING SYSTEM =====

        let currentOnboardingStep = 1;
        let selectedRole = '';
        let selectedGoals = [];

        function setupOnboardingInteractions() {
            // Role card selection
            document.querySelectorAll('.role-card').forEach(card => {
                card.addEventListener('click', () => {
                    document.querySelectorAll('.role-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    selectedRole = card.dataset.role;
                    document.getElementById('roleNextBtn').disabled = false;
                });
            });

            // Goal selection
            document.querySelectorAll('.goal-item').forEach(item => {
                item.addEventListener('click', () => {
                    item.classList.toggle('selected');
                    const goal = item.dataset.goal;
                    if (selectedGoals.includes(goal)) {
                        selectedGoals = selectedGoals.filter(g => g !== goal);
                    } else {
                        selectedGoals.push(goal);
                    }
                });
            });

            // Enter key on name input
            const nameInput = document.getElementById('userName');
            if (nameInput) {
                nameInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && nameInput.value.trim()) {
                        nextOnboardingStep();
                    }
                });
            }
        }

        function showOnboarding() {
            document.getElementById('onboardingOverlay').classList.add('active');
            currentOnboardingStep = 1;
            selectedRole = '';
            selectedGoals = [];
            updateOnboardingProgress();
        }

        function nextOnboardingStep() {
            // Validate current step
            if (currentOnboardingStep === 1) {
                const name = document.getElementById('userName').value.trim();
                if (!name) {
                    document.getElementById('userName').focus();
                    return;
                }
                state.userProfile.name = name;
            } else if (currentOnboardingStep === 2) {
                if (!selectedRole) {
                    return;
                }
                state.userProfile.role = selectedRole;
            } else if (currentOnboardingStep === 3) {
                state.userProfile.goals = selectedGoals;
            }

            // Move to next step
            document.getElementById(`step-${currentOnboardingStep}`).classList.remove('active');
            currentOnboardingStep++;
            document.getElementById(`step-${currentOnboardingStep}`).classList.add('active');
            updateOnboardingProgress();
        }

        function prevOnboardingStep() {
            document.getElementById(`step-${currentOnboardingStep}`).classList.remove('active');
            currentOnboardingStep--;
            document.getElementById(`step-${currentOnboardingStep}`).classList.add('active');
            updateOnboardingProgress();
        }

        function updateOnboardingProgress() {
            const dots = document.querySelectorAll('.progress-dot');
            dots.forEach((dot, index) => {
                if (index + 1 === currentOnboardingStep) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }

        function completeOnboarding() {
            state.userProfile.onboardingCompleted = true;
            state.userProfile.joinedDate = Date.now();

            // Generate personalized sample data
            generatePersonalizedData();

            // Save profile
            saveState();

            // Close onboarding
            document.getElementById('onboardingOverlay').classList.remove('active');

            // Show confetti
            if (typeof confetti !== 'undefined') {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            }

            // Update greeting with name
            updateGreeting();
            renderAll();
        }

        function generatePersonalizedData() {
            // Clear existing sample data
            state.tasks = [];
            state.clients = [];

            // Role-specific clients
            const clientsByRole = {
                freelancer: [
                    { name: 'Acme Corp', color: '#3A76F0', tasks: 0, time: 0 },
                    { name: 'TechStart', color: '#10B981', tasks: 0, time: 0 },
                    { name: 'Design Studio', color: '#F59E0B', tasks: 0, time: 0 }
                ],
                developer: [
                    { name: 'Main Project', color: '#3A76F0', tasks: 0, time: 0 },
                    { name: 'Open Source', color: '#10B981', tasks: 0, time: 0 }
                ],
                designer: [
                    { name: 'Client Work', color: '#3A76F0', tasks: 0, time: 0 },
                    { name: 'Personal Projects', color: '#EF476F', tasks: 0, time: 0 }
                ],
                founder: [
                    { name: 'Product Development', color: '#3A76F0', tasks: 0, time: 0 },
                    { name: 'Marketing', color: '#10B981', tasks: 0, time: 0 },
                    { name: 'Fundraising', color: '#F59E0B', tasks: 0, time: 0 }
                ],
                manager: [
                    { name: 'Team Alpha', color: '#3A76F0', tasks: 0, time: 0 },
                    { name: 'Team Beta', color: '#10B981', tasks: 0, time: 0 }
                ],
                student: [
                    { name: 'Computer Science', color: '#3A76F0', tasks: 0, time: 0 },
                    { name: 'Projects', color: '#10B981', tasks: 0, time: 0 }
                ]
            };

            state.clients = clientsByRole[selectedRole] || clientsByRole.freelancer;

            // Role-specific tasks
            const tasksByRole = {
                freelancer: [
                    { title: 'Send invoice to Acme Corp', client: 'Acme Corp', status: 'todo', priority: 'high' },
                    { title: 'Design landing page for TechStart', client: 'TechStart', status: 'inprogress', priority: 'high', estimatedHours: 3 },
                    { title: 'Review contract with Design Studio', client: 'Design Studio', status: 'backlog', priority: 'normal' }
                ],
                developer: [
                    { title: 'Fix authentication bug #urgent', client: null, status: 'inprogress', priority: 'high' },
                    { title: 'Implement dark mode feature', client: 'Main Project', status: 'todo', priority: 'normal', estimatedHours: 5 },
                    { title: 'Review pull requests', client: 'Open Source', status: 'backlog', priority: 'normal' }
                ],
                designer: [
                    { title: 'Create brand guidelines', client: 'Client Work', status: 'inprogress', priority: 'high', estimatedHours: 4 },
                    { title: 'Portfolio redesign', client: 'Personal Projects', status: 'todo', priority: 'normal' },
                    { title: 'Client presentation deck', client: 'Client Work', status: 'backlog', priority: 'normal' }
                ],
                founder: [
                    { title: 'Finalize product roadmap', client: 'Product Development', status: 'inprogress', priority: 'high' },
                    { title: 'Review investor pitch deck', client: 'Fundraising', status: 'todo', priority: 'high', estimatedHours: 2 },
                    { title: 'Plan marketing campaign', client: 'Marketing', status: 'backlog', priority: 'normal' }
                ],
                manager: [
                    { title: 'Team standup meeting', client: 'Team Alpha', status: 'todo', priority: 'high' },
                    { title: 'Review quarterly OKRs', client: 'Team Beta', status: 'inprogress', priority: 'normal' },
                    { title: 'Performance reviews', client: null, status: 'backlog', priority: 'normal' }
                ],
                student: [
                    { title: 'Complete algorithm assignment #urgent', client: 'Computer Science', status: 'inprogress', priority: 'high' },
                    { title: 'Study for midterm exam', client: 'Computer Science', status: 'todo', priority: 'high' },
                    { title: 'Work on final project', client: 'Projects', status: 'backlog', priority: 'normal', estimatedHours: 10 }
                ]
            };

            const roleTasks = tasksByRole[selectedRole] || tasksByRole.freelancer;

            roleTasks.forEach((task, i) => {
                addTask(task.title, i === 0, task.client, task.status);
                const createdTask = state.tasks[state.tasks.length - 1];
                if (task.priority) createdTask.priority = task.priority;
                if (task.estimatedHours) createdTask.estimatedHours = task.estimatedHours;
            });

            saveState();
        }

        function filterTasks(filter) {
            console.log('Filtering tasks:', filter);
        }

        // ===== INITIALIZATION =====
        setTimeout(() => {
            if (document.getElementById('welcomeScreen').classList.contains('welcome-screen')) {
                startApp();
            }
        }, 3000);
    </script>
</body>
</html>
